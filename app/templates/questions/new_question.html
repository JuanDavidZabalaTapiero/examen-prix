{% extends "base.html" %}

{% block title %}Registrar | Pregunta{% endblock %}

{% block body %}

{% include "headers/main_header.html" %}

<main class="container py-5">
    <!-- TÍTULO PRINCIPAL -->
    <h1 class="mb-4 text-center">Registrar nueva pregunta</h1>

    <!-- FORMULARIO DE PREGUNTA -->
    <form action="{{ url_for('questions.register_question') }}" method="post" enctype="multipart/form-data"
        class="card shadow p-4">

        <!-- CAMPO DE TEXTO DE LA PREGUNTA -->
        <div class="mb-3">
            <label for="question_text" class="form-label">Pregunta</label>
            <input type="text" name="question_text" id="question_text" class="form-control" required>
        </div>

        <!-- OPCIONES DE RESPUESTA -->
        <div id="options" class="mb-3">
            <label class="form-label">Opciones</label>
            <div class="option input-group mb-2">
                <input type="text" name="option_text" class="form-control" placeholder="Escribe una opción" required>
                <div class="input-group-text">
                    <input type="radio" name="correct_option" value="0" required>
                    <span class="ms-1">Correcta</span>
                </div>
            </div>
        </div>

        <!-- BOTÓN PARA AGREGAR OPCIONES -->
        <button id="add_option" class="btn btn-outline-primary btn-sm mb-3">
            <i class="bi bi-plus-circle"></i> Agregar opción
        </button>

        <!-- SUBIR IMÁGENES -->
        <div class="mb-3">
            <label class="form-label">Imágenes</label>
            <div id="images" class="d-flex flex-column gap-2">
                <input type="file" name="images" class="form-control">
            </div>
            <button id="add_image" class="btn btn-outline-secondary btn-sm mt-2">
                <i class="bi bi-image"></i> Agregar Imagen
            </button>
        </div>

        <!-- BOTONES DE ACCIÓN -->
        <div class="d-flex justify-content-between mt-4">
            <a href="{{ url_for('questions.home') }}" class="btn btn-outline-danger">
                <i class="bi bi-x-circle"></i> Cancelar
            </a>
            <button type="submit" class="btn btn-success">
                <i class="bi bi-save"></i> Registrar
            </button>
        </div>
    </form>
</main>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const divOptions = document.getElementById("options")
        const buttonAdd = document.getElementById("add_option")

        const divImages = document.getElementById("images")
        const btnAddImage = document.getElementById("add_image")

        // AGREGAR OPCIÓN
        buttonAdd.addEventListener("click", (e) => {
            e.preventDefault()

            const optionIndex = divOptions.querySelectorAll(".option").length

            const div = document.createElement("div")
            div.classList.add("option", "input-group", "mb-2")

            const textInput = document.createElement("input")
            textInput.type = "text"
            textInput.name = "option_text"
            textInput.required = true
            textInput.classList.add("form-control")
            textInput.placeholder = "Escribe una opción"

            const radioWrapper = document.createElement("div")
            radioWrapper.classList.add("input-group-text")

            const radioInput = document.createElement("input")
            radioInput.type = "radio"
            radioInput.name = "correct_option"
            radioInput.value = optionIndex

            const label = document.createElement("span")
            label.classList.add("ms-1")
            label.innerText = "Correcta"

            radioWrapper.appendChild(radioInput)
            radioWrapper.appendChild(label)

            div.appendChild(textInput)
            div.appendChild(radioWrapper)

            divOptions.appendChild(div)
        })

        // AGREGAR IMAGEN
        btnAddImage.addEventListener("click", (e) => {
            e.preventDefault()

            const wrapper = document.createElement("div")
            wrapper.classList.add("input-group", "mb-2")

            const inputFile = document.createElement("input")
            inputFile.type = "file"
            inputFile.name = "images"
            inputFile.classList.add("form-control")

            const btnTrash = document.createElement("button")
            btnTrash.type = "button"
            btnTrash.className = "btn btn-outline-danger"
            btnTrash.innerHTML = '<i class="bi bi-trash"></i>'

            // Implementar en DOM
            wrapper.appendChild(inputFile)
            wrapper.appendChild(btnTrash)
            divImages.appendChild(wrapper)

            // Evento eliminar
            btnTrash.addEventListener("click", () => {
                wrapper.remove()
            })
        })
    })
</script>
{% endblock %}